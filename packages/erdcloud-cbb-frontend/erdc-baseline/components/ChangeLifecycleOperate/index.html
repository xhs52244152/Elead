<erd-ex-dialog
    :visible.sync="visible"
    destroy-on-close
    :append-to-body="true"
    :title="i18n.setStatus"
    @closed="handleDialogClosed"
>
    <div
        ref="header"
        class="mb-xl flex justify-between"
        v-if="isBatchEdit"
    >
        <div class="w-240 grow-0">
            <erd-input
                class="w-100p"
                :placeholder="i18n.pleaseEnter"
                clearable
                v-model="searchName"
            >
            </erd-input>
        </div>
        <erd-button @click="handleBatchEdit"> {{i18n.batchEdit}} </erd-button>
    </div>
    <vxe-table
        border
        max-height="400"
        class="baseline-vxe-table"
        :data="filteredTableData"
        :edit-config="{trigger: 'click', mode: 'cell', showIcon: false}"
        @checkbox-change="checkboxChange"
        @checkbox-all="checkboxAll"
        @edit-actived="editActivedEvent"
        header-cell-class-name="baseline-operate-table-header-cell"
    >
        <vxe-column
            v-if="isBatchEdit"
            type="checkbox"
            width="40"
            title=""
            align="center"
        ></vxe-column>
        <vxe-column
            type="seq"
            width="48"
            title=" "
            align="center"
        ></vxe-column>
        <vxe-column
            field="name"
            show-overflow="title"
            :title="i18n.name"
        ></vxe-column>
        <vxe-column
            field="code"
            show-overflow="title"
            :title="i18n.code"
        >
        </vxe-column>
        <vxe-column
            field="lifecycleStatus"
            show-overflow="title"
            :title="i18n.currentLifecycleStatus"
        >
        </vxe-column>
        <vxe-column
            field="newLifecycleStatus"
            show-overflow="title"
            :title="i18n.lifecycleStatus"
            :edit-render="{}"
        >
            <template #header>
                <i class="erd-iconfont erd-icon-edit"></i>
                <span>{{i18n.lifecycleStatus}}</span>
            </template>
            <template #default="{ row }">
                <span
                    :class="{'color-disabled': !getLifecycleStatusConfig(row)?.label}"
                    :title="getLifecycleStatusConfig(row)?.label"
                    >{{getLifecycleStatusConfig(row)?.label || i18n.pleaseSelect}}</span
                >
            </template>
            <template #edit="{ row }">
                <erd-ex-select
                    size="small"
                    :ref="`select-${row.oid}`"
                    popper-class="vxe-table--ignore-clear"
                    filterable
                    class="w-100p baseline-select-container"
                    v-model="row.newLifecycleStatus"
                    :options="row.lifecycleStatusOptions"
                >
                </erd-ex-select>
            </template>
        </vxe-column>
    </vxe-table>
    <erd-ex-dialog
        width="600px"
        :visible.sync="visibleForBatchEdit"
        :append-to-body="true"
        :title="i18n.batchEditStatus"
        destroy-on-close
    >
        <erd-form
            :model="batchEditFormData"
            label-position="right"
            label-width="20%"
        >
            <erd-form-item
                :label="i18n.lifecycleStatus"
                class="mb-0"
            >
                <template #label>
                    <span class="color-normal">{{i18n.lifecycleStatus}}</span>
                </template>
                <erd-ex-select
                    class="w-100p baseline-select-container"
                    filterable
                    v-model="batchEditFormData.lifecycleStatus"
                    :options="lifecycleStatusOptions"
                >
                </erd-ex-select>
            </erd-form-item>
        </erd-form>
        <template slot="footer">
            <erd-button
                type="primary"
                @click="saveBatchEditData"
                >{{i18n.done}}</erd-button
            >
            <erd-button @click="visibleForBatchEdit = false">{{i18n.cancel}}</erd-button>
        </template>
    </erd-ex-dialog>
    <template slot="footer">
        <erd-button
            type="primary"
            @click="handleChangeState"
            >{{i18n.done}}</erd-button
        >
        <erd-button @click="visible = false">{{i18n.cancel}}</erd-button>
    </template>
</erd-ex-dialog>
