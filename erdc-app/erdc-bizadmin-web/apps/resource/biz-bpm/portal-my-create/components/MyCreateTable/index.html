<div
    id="my-create-table"
    class="h_100p"
>
    <fam-view-table
        :view-table-config="viewTableConfig"
        @handler-data="handlerData"
        @fn-control-icon="fnControlIcon"
        ref="famViewTable"
    >
        <template #left:toolbar:first>
            <erd-button-group>
                <erd-button
                    v-for="(btn, index) in leftButtonGroup"
                    :key="index"
                    @click="btn.onclick(btn, index)"
                    :class="getActiveClass(btn, index)"
                >
                    {{ btn.label }}<span v-if="btn.state !== 'all'">({{ btn.number || 0 }})</span>
                </erd-button>
            </erd-button-group>
        </template>
        <!-- 到期日期 -->
        <template v-slot:[slotName.dueDate]="{ scope }">
            <BpmDueData :due-data="getDueDate(scope)"></BpmDueData>
        </template>
        <!-- 流程状态 -->
        <template v-slot:[slotName.processStatus]="{ scope }">
            <BpmProcessStatus :status="getStatus(scope)"></BpmProcessStatus>
        </template>
        <!-- 操作 -->
        <template #column:default:operation:content="{ scope }">
            <fam-action-pulldown
                :ref="'FamActionPulldown' + '_' + scope.rowIndex"
                :is-operation="true"
                :action-config="getActionConfig(scope.row)"
                :action-data="scope.row"
                @click="onCommand"
            ></fam-action-pulldown>
        </template>
    </fam-view-table>
    <!-- 查看流程图 -->
    <erd-ex-dialog
        :title="bpmFlowchart.title"
        :visible.sync="bpmFlowchart.visible"
        fullscreen
        :show-fullscreen="false"
    >
        <bpm-flowchart
            v-if="bpmFlowchart.visible"
            :processDefinitionId="bpmFlowchart.processDefinitionId"
            :processInstanceId="bpmFlowchart.processInstanceId"
        ></bpm-flowchart>
    </erd-ex-dialog>

    <!-- 催办 -->
    <erd-ex-dialog
        :title="urgeForm.title"
        :visible.sync="urgeForm.visible"
        :destroy-on-close="true"
    >
        <BpmUrge
            v-if="urgeForm.visible"
            ref="bpmUrge"
            :process-instance-oid="urgeForm.processInstanceOid"
        ></BpmUrge>
        <template #footer>
            <erd-button
                v-loading="loading"
                type="primary"
                @click="urgeConfirm"
            >{{i18n.confirm}}</erd-button>
            <erd-button @click="popover({ field: 'urgeForm' })">{{i18n.cancel}}</erd-button>
        </template>
    </erd-ex-dialog>

    <!-- 终止 -->
    <erd-ex-dialog
        :title="i18nMappingObj.termination"
        :visible.sync="terminateForm.visible"
        @close="terminateForm.processInstanceOid = ''"
    >
        <bpm-terminate-form
            v-if="terminateForm.visible"
            ref="terminateForm"
        ></bpm-terminate-form>
        <template #footer>
            <erd-button
                type="primary"
                v-loading="loading"
                @click="!loading && terminationConfirm()"
                >{{ i18nMappingObj.confirm }}</erd-button
            >
            <erd-button @click="popover({ field: 'terminateForm' })">{{ i18nMappingObj.cancel }}</erd-button>
        </template>
    </erd-ex-dialog>

    <!-- 查看任务 -->
    <erd-ex-dialog
        size="large"
        :title="viewTaskForm.title"
        :visible.sync="viewTaskForm.visible"
        @close="viewTaskForm.processInstanceId = ''"
    >
        <bpm-view-task
            v-if="viewTaskForm.visible"
            :process-instance-id="viewTaskForm.processInstanceId"
            @close-dialog="viewTaskFormVisible"
        ></bpm-view-task>
    </erd-ex-dialog>
</div>
