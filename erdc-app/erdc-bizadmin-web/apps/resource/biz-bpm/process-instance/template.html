<div
    id="bpm-instance-content"
    class="bpm-instance-content h_100p"
    v-cloak
>
    <fam-resizable-container
        :left.sync="left"
        class="h_100p"
    >
        <template v-slot:left>
            <div class="tree-management h_100p">
                <fam-tree
                    ref="erdExTree"
                    :title="i18n.processType"
                    :placeholder="i18n.searchKeyword"
                    :data="listData"
                    :props="{ label: 'displayName', children: 'childList' }"
                    default-expand-all
                    highlight-current
                    :filter-node-method="filterNode"
                    :expand-on-click-node="false"
                    @node-click="handleNodeClick"
                ></fam-tree>
            </div>
        </template>
        <template v-slot:right>
            <div class="bpm-instance-content-table h_100p">
                <fam-view-table
                    ref="famViewTable"
                    :view-table-config="viewTableConfig"
                    @handler-data="handlerData"
                >
                    <!-- 到期日期 -->
                    <template v-slot:[slotName.dueDate]="{ scope }">
                        <BpmDueData :due-data="getDueDate(scope)"></BpmDueData>
                    </template>
                    <!-- 流程状态 -->
                    <template v-slot:[slotName.processStatus]="{ scope }">
                        <BpmProcessStatus :status="getStatus(scope)"></BpmProcessStatus>
                    </template>
                    <template #column:default:operation:content="{ scope }">
                        <fam-action-pulldown
                            :ref="'FamActionPulldown' + '_' + scope.rowIndex"
                            :is-operation="true"
                            :action-config="getActionConfig(scope.row)"
                            :action-data="scope.row"
                            @click="actionClick"
                        ></fam-action-pulldown>
                    </template>
                </fam-view-table>
            </div>
        </template>
    </fam-resizable-container>

    <!-- 查看流程图 -->
    <erd-ex-dialog
        :title="bpmFlowchart.title"
        :visible.sync="bpmFlowchart.visible"
        fullscreen
        :show-fullscreen="false"
        @close="bpmFlowchart.processDefinitionId = ''"
    >
        <bpm-flowchart
            v-if="bpmFlowchart.visible"
            :processDefinitionId="bpmFlowchart.processDefinitionId"
            :processInstanceId="bpmFlowchart.processInstanceId"
        ></bpm-flowchart>
    </erd-ex-dialog>

    <!-- 查看任务 -->
    <erd-ex-dialog
        width="1200px"
        :title="viewTaskForm.title"
        :visible.sync="viewTaskForm.visible"
        @close="viewTaskForm.processInstanceId = ''"
    >
        <bpm-view-task
            v-if="viewTaskForm.visible"
            :process-instance-id="viewTaskForm.processInstanceId"
            @close-dialog="viewTaskFormVisible"
        ></bpm-view-task>
    </erd-ex-dialog>

    <!-- 终止 -->
    <erd-ex-dialog
        style="height: 300px"
        :title="terminateForm.title"
        :visible.sync="terminateForm.visible"
        @close="terminateForm.processInstanceOid = ''"
    >
        <bpm-terminate-form
            v-if="terminateForm.visible"
            ref="terminateForm"
        ></bpm-terminate-form>
        <template #footer>
            <erd-button
                type="primary"
                v-loading="loading"
                @click="!loading && terminateClick()"
                >{{i18n.confirm}}</erd-button
            >
            <erd-button @click="popover({ field: 'terminateForm' })">{{i18n.cancel}}</erd-button>
        </template>
    </erd-ex-dialog>

    <!-- 修改处理人 -->
    <erd-ex-dialog
        size="large"
        :title="changeHandlerForm.title"
        :visible.sync="changeHandlerForm.visible"
        @close="changeHandlerForm.handlerConfiguration = []; changeHandlerForm.userRoleMap = {}; changeHandlerForm.oid = ''"
    >
        <ChangeHandler
            v-if="changeHandlerForm.visible"
            ref="changeHandlerForm"
            :handler-configuration="changeHandlerForm.handlerConfiguration"
            :user-role-map="changeHandlerForm.userRoleMap"
            :holder-ref="changeHandlerForm.holderRef"
            :container-ref="changeHandlerForm.containerRef"
        ></ChangeHandler>
        <template #footer>
            <erd-button
                type="primary"
                v-loading="loading"
                @click="!loading && changeHandlerClick()"
                >{{i18n.confirm}}</erd-button
            >
            <erd-button @click="popover({ field: 'changeHandlerForm' })">{{i18n.cancel}}</erd-button>
        </template>
    </erd-ex-dialog>
</div>
