<div class="role_team">
    <div class="role_team_head">
        <div class="team_head_left">
            <erd-input
                v-model="searchVal"
                :placeholder="i18nMappingObj.searchTips"
                suffix-icon="erd-iconfont erd-icon-search"
                clearable
                style="width: 300px"
                @input="onInput"
                v-if="isShow"
            >
            </erd-input>
            <erd-checkbox
                v-if="!isShow"
                v-model="onlyShowRole"
                @change="handleChecked"
            >
                {{i18nMappingObj.onlyShowRole}}
            </erd-checkbox>
        </div>
        <div
            class="team_head_right"
            v-if="treeDetail.status !== 'inactive'"
        >
            <erd-button
                v-if="isShow"
                type="primary"
                @click="handleAdd"
                >{{ i18nMappingObj.add }}</erd-button
            >
            <erd-button
                v-if="isShow"
                @click="handleRemove"
                >{{ i18nMappingObj.remove }}</erd-button
            >
            <erd-button
                v-if="!isShow"
                class="refreshBtn"
                icon="el-icon-refresh"
                @click="onRefresh"
            >
            </erd-button>
        </div>
    </div>
    <fam-erd-table
        :data="tableData"
        v-bind="tableConfig"
        :column-config="{ resizable: true }"
        @checkbox-all="selectChangeEvent"
        @checkbox-change="selectChangeEvent"
        ref="erdRoleTable"
    >
        <template #column:default:principalTarget="{data}">
            <span> {{ data.row?.principalTarget | filterType}} </span>
        </template>
        <!--自定义模板 default[自定义内容] 命名规则: column:slotType:prop-->
        <template
            #column:default:operate="{data}"
            v-if="treeDetail.status !== 'inactive'"
        >
            <erd-dropdown
                trigger="click"
                v-if="isShow"
            >
                <erd-link
                    :underline="false"
                    style="font-weight: unset"
                    >{{i18nMappingObj.more}}<i class="el-icon-arrow-down el-icon--right"></i>
                </erd-link>
                <erd-dropdown-menu slot="dropdown">
                    <erd-dropdown-item
                        @click.native="fnAddRole(data.row)"
                        v-if="(data.row?.parentId === '-1' || data.row?.principalTarget === 'ROLE') && showCreateRole && isShow"
                    >
                        {{ i18nMappingObj.member }}
                    </erd-dropdown-item>
                    <erd-dropdown-item v-else-if="data.row.parentId && data.row.principalTarget === 'USER' && isShow">
                        <span
                            v-if="!data.row.primarily"
                            @click="onSetResp(data.row)"
                        >
                            {{ i18nMappingObj.responsible }}
                        </span>
                        <span
                            v-else
                            @click="onCancelResp(data.row)"
                        >
                            {{ i18nMappingObj.cancelResponsible }}
                        </span>
                    </erd-dropdown-item>

                    <erd-dropdown-item
                        v-if="data.row.principalTarget === 'GROUP'"
                        @click.native="lookUser(data.row)"
                    >
                        {{ i18nMappingObj.lookUser }}
                    </erd-dropdown-item>
                    <erd-dropdown-item @click.native="fnRemoveRole(data.row)">
                        {{ i18nMappingObj.remove }}
                    </erd-dropdown-item>
                </erd-dropdown-menu>
            </erd-dropdown>
            <!-- <erd-button
                v-if="(data.row?.parentId === '-1' || data.row?.principalTarget === 'ROLE') && showCreateRole && isShow"
                type="text"
                @click="fnAddRole(data.row)"
                >{{ i18nMappingObj.member }}</erd-button
            > -->
            <!-- <template
                style="display: inline-block"
                v-else-if="data.row.parentId && data.row.principalTarget === 'USER' && isShow"
            > -->
            <!-- <erd-button
                    type="text"
                    v-if="!data.row.primarily"
                    @click="onSetResp(data.row)"
                    >{{ i18nMappingObj.responsible }}
                </erd-button> -->
            <!-- <erd-button
                    type="text"
                    v-else
                    @click="onCancelResp(data.row)"
                    >{{ i18nMappingObj.cancelResponsible }}
                </erd-button> -->
            <!-- </template> -->
            <!-- <erd-button
                type="text"
                v-if="isShow"
                @click="fnRemoveRole(data.row)"
                >{{ i18nMappingObj.remove }}</erd-button
            >
            <erd-button
                v-if="data.row.principalTarget === 'GROUP'"
                type="text"
                @click="lookUser(data.row)"
                >{{ i18nMappingObj.lookUser }}</erd-button
            > -->
            <erd-button
                v-if="data.row.principalTarget === 'GROUP' && !isShow"
                type="text"
                @click="lookUser(data.row)"
                >{{ i18nMappingObj.lookUser }}</erd-button
            >
        </template>
        <template #column:default:principalName="{data}">
            <span
                v-if="data.row.primarily"
                class="team-responsible"
                >{{i18nMappingObj.mainResponsible}}</span
            >
            <span>{{ data.row.principalName }}</span>
        </template>
    </fam-erd-table>
    <open-create-team
        v-if="dialogVisible"
        :show-add-member="showCreateRole"
        type="addRole"
        :team-oid="oid"
        :currentRow="currentOperRole"
        :role-refer="roleRef"
        :visible.sync="dialogVisible"
        :title="dialogTitle"
        :className="className"
        addRoleUrl="/cbb/heavyTeam/participants/add"
        getPrincipalsUrl="/cbb/heavyTeam/getPrincipalsById"
        :current-role-data="currentOperRole"
        :query-params="queryParams"
        :first-role="firstRole"
        :show-participant-type="showParticipantType"
        @onsubmit="onSubmit"
    >
    </open-create-team>
    <look-user
        v-if="dialogVisibleUser"
        :visible.sync="dialogVisibleUser"
        :currentOperRole="currentOperRole"
    ></look-user>
</div>
